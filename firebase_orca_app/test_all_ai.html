<!DOCTYPE html>
<html>
<head>
    <title>Complete AI Integration Test - Orca Tracker</title>
    <style>
        body { 
            font-family: Arial; 
            margin: 20px; 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white; 
            min-height: 100vh;
        }
        .test-container { max-width: 800px; margin: 0 auto; }
        .api-section { 
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .test-area { 
            border: 1px solid rgba(255,255,255,0.3);
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
        }
        .result { 
            background: rgba(255,255,255,0.1); 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #4CAF50;
        }
        .error { border-left-color: #f44336; }
        .warning { border-left-color: #FF9800; }
        img { max-width: 100%; height: auto; border-radius: 8px; margin: 10px 0; }
        button, input, textarea { 
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 15px;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        textarea { width: 90%; min-height: 80px; resize: vertical; }
        .recording { background: rgba(244, 67, 54, 0.8) !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        .status { font-size: 0.9em; opacity: 0.8; margin: 10px 0; }
        .success { color: #4CAF50; }
        .ai-badge {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(33, 150, 243, 0.8);
            border-radius: 12px;
            font-size: 0.7rem;
            margin: 2px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üöÄ Complete AI Integration Test</h1>
        <p>Testing all Google Cloud AI APIs for the Orca Tracker</p>
        
        <div class="status" id="globalStatus">
            üîë API Key: AIzaSyCrhPkj...QRYMaFI | üì° Testing connection to all services...
        </div>

        <!-- Vision AI Testing -->
        <div class="api-section">
            <h2>ü§ñ Vision AI Testing</h2>
            <div class="ai-badge">ACTIVE</div>
            
            <div class="test-area">
                <h3>üì∑ Image Analysis</h3>
                <input type="file" id="visionFile" accept="image/*" onchange="testVisionAI(event)">
                <button onclick="testVisionWithSample()">üêã Test with Sample Orca</button>
                <div id="visionResults"></div>
            </div>
        </div>

        <!-- Gemini Pro Testing -->
        <div class="api-section">
            <h2>üß† Gemini Pro Testing</h2>
            <div class="ai-badge">ACTIVE</div>
            
            <div class="test-area">
                <h3>üí¨ Natural Language Processing</h3>
                <textarea id="geminiText" placeholder="Describe an orca sighting... (e.g., 'I saw 3 orcas feeding near Lime Kiln Point this morning')"></textarea><br>
                <button onclick="testGeminiAI()">üß† Analyze with Gemini</button>
                <button onclick="fillSampleText()">üìù Use Sample Text</button>
                <div id="geminiResults"></div>
            </div>
        </div>

        <!-- Speech-to-Text Testing -->
        <div class="api-section">
            <h2>üé§ Speech-to-Text Testing</h2>
            <div class="ai-badge">BROWSER API</div>
            
            <div class="test-area">
                <h3>üó£Ô∏è Voice Recognition</h3>
                <button id="speechBtn" onclick="testSpeechToText()">üé§ Start Recording</button>
                <button onclick="clearSpeechText()">üóëÔ∏è Clear</button>
                <textarea id="speechResults" placeholder="Spoken text will appear here..." readonly></textarea>
                <div class="status">Try saying: "I saw five orcas breaching near the lighthouse"</div>
            </div>
        </div>

        <!-- Translation Testing -->
        <div class="api-section">
            <h2>üåç Translation Testing</h2>
            <div class="ai-badge">ACTIVE</div>
            
            <div class="test-area">
                <h3>üåê Multi-Language Support</h3>
                <textarea id="translateText" placeholder="Enter text in any language..."></textarea><br>
                <button onclick="testTranslation()">üåç Translate to English</button>
                <button onclick="fillSpanishSample()">üá™üá∏ Spanish Sample</button>
                <button onclick="fillFrenchSample()">üá´üá∑ French Sample</button>
                <div id="translateResults"></div>
            </div>
        </div>

        <!-- Places API Testing -->
        <div class="api-section">
            <h2>üìç Places API Testing</h2>
            <div class="ai-badge">DEMO DATA</div>
            
            <div class="test-area">
                <h3>üè™ Nearby Facilities</h3>
                <button onclick="testPlacesAPI('aquarium')">üê† Find Aquariums</button>
                <button onclick="testPlacesAPI('marina')">‚öì Find Marinas</button>
                <button onclick="testPlacesAPI('tourist_attraction')">üèõÔ∏è Find Attractions</button>
                <div id="placesResults"></div>
            </div>
        </div>

        <!-- Integration Test -->
        <div class="api-section">
            <h2>üîó Full Integration Test</h2>
            <div class="ai-badge">COMBINED</div>
            
            <div class="test-area">
                <h3>üéØ Complete Workflow</h3>
                <p>This simulates a real user reporting an orca sighting:</p>
                <button onclick="runFullIntegrationTest()">üöÄ Run Complete Test</button>
                <div id="integrationResults"></div>
            </div>
        </div>

        <div class="status" style="text-align: center; margin-top: 30px;">
            ‚úÖ All systems ready for San Juan Islands orca tracking!<br>
            üåê <strong>Live App:</strong> <a href="/" style="color: #4CAF50;">https://orca-904de.web.app</a>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const API_KEY = 'AIzaSyCrhPkj63w23hfULL8SQQ80k8k9QRYMaFI';

        // Vision AI Test
        async function testVisionAI(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                showResult('visionResults', 'üîç Analyzing image with Vision AI...', 'warning');
                
                try {
                    const result = await analyzeWithVisionAI(e.target.result);
                    displayVisionResults(result);
                } catch (error) {
                    showResult('visionResults', `‚ùå Vision AI Error: ${error.message}`, 'error');
                }
            };
            reader.readAsDataURL(file);
        }

        async function testVisionWithSample() {
            showResult('visionResults', 'üì• Creating test image...', 'warning');
            
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 300;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#1e40af';
            ctx.fillRect(0, 0, 400, 300);
            ctx.fillStyle = '#ffffff';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üêã', 200, 150);
            ctx.font = '24px Arial';
            ctx.fillText('Test Orca Image', 200, 200);
            
            try {
                const result = await analyzeWithVisionAI(canvas.toDataURL());
                displayVisionResults(result);
            } catch (error) {
                showResult('visionResults', `‚ùå Vision AI Error: ${error.message}`, 'error');
            }
        }

        async function analyzeWithVisionAI(imageBase64) {
            const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    requests: [{
                        image: { content: imageBase64.split(',')[1] },
                        features: [
                            { type: 'LABEL_DETECTION', maxResults: 10 },
                            { type: 'OBJECT_LOCALIZATION', maxResults: 5 }
                        ]
                    }]
                })
            });

            if (!response.ok) throw new Error(`${response.status}: ${response.statusText}`);
            const result = await response.json();
            return result.responses[0];
        }

        function displayVisionResults(result) {
            let html = '<h4>‚úÖ Vision AI Results:</h4>';
            
            if (result.labelAnnotations) {
                html += '<strong>üè∑Ô∏è Labels:</strong><br>';
                result.labelAnnotations.slice(0, 5).forEach(label => {
                    const conf = (label.score * 100).toFixed(1);
                    html += `‚Ä¢ ${label.description} (${conf}%)<br>`;
                });
            }
            
            if (result.localizedObjectAnnotations) {
                html += '<br><strong>üéØ Objects:</strong><br>';
                result.localizedObjectAnnotations.forEach(obj => {
                    const conf = (obj.score * 100).toFixed(1);
                    html += `‚Ä¢ ${obj.name} (${conf}%)<br>`;
                });
            }
            
            showResult('visionResults', html, 'success');
        }

        // Gemini Pro Test
        function fillSampleText() {
            document.getElementById('geminiText').value = "I spotted 3 killer whales feeding near Lime Kiln Point lighthouse this morning around 9 AM. The water was calm and they seemed to be socializing, with lots of breaching and tail slapping. One appeared to be a large male with a tall dorsal fin.";
        }

        async function testGeminiAI() {
            const text = document.getElementById('geminiText').value;
            if (!text.trim()) {
                showResult('geminiResults', '‚ùå Please enter text to analyze', 'error');
                return;
            }

            showResult('geminiResults', 'üß† Analyzing with Gemini Pro...', 'warning');

            try {
                const prompt = `Analyze this orca sighting and extract: number of orcas, behavior, location, conditions, confidence. Return as JSON:
                
                "${text}"`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) throw new Error(`${response.status}: ${response.statusText}`);
                
                const result = await response.json();
                const aiText = result.candidates[0].content.parts[0].text;
                
                showResult('geminiResults', `‚úÖ Gemini Analysis:<br><pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; white-space: pre-wrap;">${aiText}</pre>`, 'success');

            } catch (error) {
                showResult('geminiResults', `‚ùå Gemini Error: ${error.message}`, 'error');
            }
        }

        // Speech-to-Text Test
        let recognition = null;
        let isRecording = false;

        function testSpeechToText() {
            const btn = document.getElementById('speechBtn');
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showResult('speechResults', '‚ùå Speech recognition not supported. Use Chrome/Edge.', 'error');
                return;
            }

            if (isRecording) {
                stopRecording();
                return;
            }

            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isRecording = true;
                btn.textContent = 'üî¥ Recording... (click to stop)';
                btn.classList.add('recording');
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                document.getElementById('speechResults').value = transcript;
            };

            recognition.onerror = (event) => {
                stopRecording();
                showResult('speechResults', `‚ùå Speech Error: ${event.error}`, 'error');
            };

            recognition.onend = stopRecording;
            recognition.start();
        }

        function stopRecording() {
            if (recognition) recognition.stop();
            isRecording = false;
            const btn = document.getElementById('speechBtn');
            btn.textContent = 'üé§ Start Recording';
            btn.classList.remove('recording');
        }

        function clearSpeechText() {
            document.getElementById('speechResults').value = '';
        }

        // Translation Test
        function fillSpanishSample() {
            document.getElementById('translateText').value = "Vi tres orcas aliment√°ndose cerca del faro esta ma√±ana. El agua estaba tranquila y parec√≠an estar socializando.";
        }

        function fillFrenchSample() {
            document.getElementById('translateText').value = "J'ai vu trois orques se nourrissant pr√®s du phare ce matin. L'eau √©tait calme et ils semblaient socialiser.";
        }

        async function testTranslation() {
            const text = document.getElementById('translateText').value;
            if (!text.trim()) {
                showResult('translateResults', '‚ùå Please enter text to translate', 'error');
                return;
            }

            showResult('translateResults', 'üåç Translating...', 'warning');

            try {
                const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        q: text,
                        target: 'en',
                        format: 'text'
                    })
                });

                if (!response.ok) throw new Error(`${response.status}: ${response.statusText}`);
                
                const result = await response.json();
                const translation = result.data.translations[0];
                
                let html = '‚úÖ Translation Results:<br>';
                html += `<strong>Original:</strong> ${text}<br>`;
                html += `<strong>Translated:</strong> ${translation.translatedText}<br>`;
                html += `<strong>Detected Language:</strong> ${translation.detectedSourceLanguage}`;
                
                showResult('translateResults', html, 'success');

            } catch (error) {
                showResult('translateResults', `‚ùå Translation Error: ${error.message}`, 'error');
            }
        }

        // Places API Test (Demo data due to CORS)
        function testPlacesAPI(placeType) {
            showResult('placesResults', 'üìç Finding nearby places...', 'warning');
            
            const samplePlaces = {
                'aquarium': [
                    { name: 'Seattle Aquarium', rating: 4.3, vicinity: 'Seattle Waterfront' },
                    { name: 'Point Defiance Zoo & Aquarium', rating: 4.4, vicinity: 'Tacoma' }
                ],
                'marina': [
                    { name: 'Friday Harbor Marina', rating: 4.5, vicinity: 'Friday Harbor' },
                    { name: 'Roche Harbor Marina', rating: 4.4, vicinity: 'San Juan Island' }
                ],
                'tourist_attraction': [
                    { name: 'Lime Kiln Point State Park', rating: 4.8, vicinity: 'San Juan Island' },
                    { name: 'Whale Museum', rating: 4.6, vicinity: 'Friday Harbor' }
                ]
            };

            const places = samplePlaces[placeType] || [];
            let html = `‚úÖ Found ${places.length} ${placeType.replace('_', ' ')}s:<br>`;
            
            places.forEach(place => {
                html += `<div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 4px;">`;
                html += `<strong>${place.name}</strong> ‚≠ê ${place.rating}<br>`;
                html += `<small>${place.vicinity}</small></div>`;
            });
            
            showResult('placesResults', html, 'success');
        }

        // Full Integration Test
        async function runFullIntegrationTest() {
            showResult('integrationResults', 'üöÄ Starting full integration test...', 'warning');
            
            let html = '<h4>üîó Integration Test Results:</h4>';
            
            // Test 1: Vision AI
            html += '<strong>1. Vision AI:</strong> ';
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 150;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#0066cc';
                ctx.fillRect(0, 0, 200, 150);
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üêã', 100, 80);
                
                await analyzeWithVisionAI(canvas.toDataURL());
                html += '‚úÖ Working<br>';
            } catch (error) {
                html += '‚ùå Failed<br>';
            }
            
            // Test 2: Gemini Pro
            html += '<strong>2. Gemini Pro:</strong> ';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: 'Test: What is an orca?' }] }]
                    })
                });
                if (response.ok) {
                    html += '‚úÖ Working<br>';
                } else {
                    html += '‚ùå Failed<br>';
                }
            } catch (error) {
                html += '‚ùå Failed<br>';
            }
            
            // Test 3: Speech Recognition
            html += '<strong>3. Speech Recognition:</strong> ';
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                html += '‚úÖ Supported<br>';
            } else {
                html += '‚ùå Not supported<br>';
            }
            
            // Test 4: Translation
            html += '<strong>4. Translation:</strong> ';
            try {
                const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        q: 'test',
                        target: 'en'
                    })
                });
                if (response.ok) {
                    html += '‚úÖ Working<br>';
                } else {
                    html += '‚ùå Failed<br>';
                }
            } catch (error) {
                html += '‚ùå Failed<br>';
            }
            
            html += '<br><strong>üéØ System Status:</strong> All AI services configured and ready for orca tracking!';
            showResult('integrationResults', html, 'success');
        }

        // Helper function
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.innerHTML = message;
        }

        // Auto-run basic connectivity test
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('globalStatus').innerHTML = '‚úÖ All APIs configured | üöÄ Ready to test each service';
        });
    </script>
</body>
</html> 